<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CSCI 305 Project 1</title>
    
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Domine">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">



     <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet"
      href="style.css">

      
  </head>
  <body>
    <div class="container pad" >
    	
       <img src="icon.png" style="height: 15%; width:15%; min-width: 171px; min-height: 163px; display:inline-block;  margin:0 auto;">
       <img src="logo.png" style="height: 25%; width:25%; min-width:290px; min-height:130px;  display:inline-block; margin:0 auto;">
      
      <div class="row">
        <div class="col-12 head top">
        	<h3 class="outline"> Movie Database Browser</h3>
        </div>
        <div class="col-12 content">
        	<div class="row">
       			<div class="col-lg-4 col-md-12 col-sm-12 section" >
       				<div class="row mg-0 ">
        			<div class="col-12"><form action="javascript:searchTitle(); return false;"><h4 class= "underlined">Search By Movie Title:</h4><input id="Title" type="text"></form></div>
        			
        			<div class="col-lg-4 col-md-12 col-sm-12 mt-10 lgfont op">
       					<p style="margin-bottom: 0px;">Show rating statistics? </p><p style="font-size: 10px; margin-bottom: 5px;">(Total, average, highest, lowest)</p>
        				<select style="margin-bottom:10px; margin-top:0px;" id="showstats"><option value="yes">Yes</option><option value="no" selected>No</option></select>
        				<p style="font-size: 8px;">*NOTE: Selecting 'yes' may cause results to take up to 15 seconds to appear, and will limit results to the first 30 movies.</p>
        			</div>
        			<div class="col-lg-4 col-md-12 col-sm-12 mt-10 lgfont op">
        				<p style="margin-bottom: 5px;">Show genres?</p>
        				<select style="margin-bottom:10px; margin-top:0px;" id="showgenres"><option value="yes">Yes</option><option value="no">No</option></select>
        			</div>
        			<div class="col-lg-4 col-md-12 col-sm-12 mt-10 lgfont op">
        				<p style="margin-bottom: 5px;">Show release year?</p>
        				<select style="margin-bottom:10px; margin-top:0px;" id="showyear"><option value="yes">Yes</option><option value="no">No</option></select>
        			</div>
        			<div class="col-lg-6 col-md-12 col-sm-12 lgfont op y">
        				<p style="margin-bottom: 5px;">List all ratings?</p>
        				<select style="margin-bottom:10px; margin-top:0px;" id="showrating"><option value="yes">Yes</option><option value="no" selected>No</option></select>
        			</div>
        			<div class= "col-lg-6 col-md-12 col-sm-12 lgfont op y">
        				<p style="margin-bottom: 5px;">List all tags?</p>
        				<select style="margin-bottom:10px; margin-top:0px;" id="showtags"><option value="yes">Yes</option><option value="no">No</option></select>
        			</div>
        			<div class="col-12">
        				<button class="sub " type="button" onclick="searchTitle()">Search Title</button>
        				
        			</div>
        			</div>
        		</div>
        		<div class="col-lg-4 col-md-12 col-sm-12 section y2">
         			<div><form action="javascript:searchGenre();"><h4 class="underlined">Search by Genre:</h4><input id="genre" type="text"></form>
         			</div>	
         			<div >
         			<button class="sub" type="button" onclick="searchGenre()">Search Genre</button></div>
        			</div>
       
        <div class="col-lg-4 col-md-12 col-sm-12 section y2">
        <div class="section y3" >
        <h4 class="underlined">Display Number Of:</h4>
        <div>
        <select id= "countSelect">
        	<option value="user">Users</option>
        	<option value="movie">Movies</option>
        	<option value="rating">Ratings</option>
        	<option value="tag">Tags</option>
        </select>
        </div>
        <button class="sub" type="button" onclick="giveCount()">Find Total</button>
        </div>
        <div class="col-12 section"><h4 class="underlined">Display Users by State: </h4><p class="lgfont" style="margin-bottom: 0px;">Enter a State:</p><select id="stateSearch"><option value="AL">Alabama</option>
	<option value="AK">Alaska</option>
	<option value="AZ">Arizona</option>
	<option value="AR">Arkansas</option>
	<option value="CA">California</option>
	<option value="CO">Colorado</option>
	<option value="CT">Connecticut</option>
	<option value="DE">Delaware</option>
	<option value="DC">District Of Columbia</option>
	<option value="FL">Florida</option>
	<option value="GA">Georgia</option>
	<option value="HI">Hawaii</option>
	<option value="ID">Idaho</option>
	<option value="IL">Illinois</option>
	<option value="IN">Indiana</option>
	<option value="IA">Iowa</option>
	<option value="KS">Kansas</option>
	<option value="KY">Kentucky</option>
	<option value="LA">Louisiana</option>
	<option value="ME">Maine</option>
	<option value="MD">Maryland</option>
	<option value="MA">Massachusetts</option>
	<option value="MI">Michigan</option>
	<option value="MN">Minnesota</option>
	<option value="MS">Mississippi</option>
	<option value="MO">Missouri</option>
	<option value="MT">Montana</option>
	<option value="NE">Nebraska</option>
	<option value="NV">Nevada</option>
	<option value="NH">New Hampshire</option>
	<option value="NJ">New Jersey</option>
	<option value="NM">New Mexico</option>
	<option value="NY">New York</option>
	<option value="NC">North Carolina</option>
	<option value="ND">North Dakota</option>
	<option value="OH">Ohio</option>
	<option value="OK">Oklahoma</option>
	<option value="OR">Oregon</option>
	<option value="PA">Pennsylvania</option>
	<option value="RI">Rhode Island</option>
	<option value="SC">South Carolina</option>
	<option value="SD">South Dakota</option>
	<option value="TN">Tennessee</option>
	<option value="TX">Texas</option>
	<option value="UT">Utah</option>
	<option value="VT">Vermont</option>
	<option value="VA">Virginia</option>
	<option value="WA">Washington</option>
	<option value="WV">West Virginia</option>
	<option value="WI">Wisconsin</option>
	<option value="WY">Wyoming</option></select>
	<div>
	<button class="sub" type="button" onclick="searchState()" style="margin-top:10px; margin-bottom: 15px;">Search for users</button></div>
        </div>
        	
        </div>
        <div class="col-12 section y2">
        	
        	<div class="row mg-0">
        	<div class="col-lg-6 col-md-6 col-sm-12 section y3">
        	<div class="col-12 "><h4 class="underlined">Create a New User</h4><form action="javascript:createUser(); return false;"><p class="lgfont" style="margin-bottom: 0px;">Enter a Username:</p><input id="updateUname" type="text" style="margin-bottom: 10px;"></form></div>
        	<div class="col-12"><p class="lgfont" style="margin-bottom: 0px;">Enter your State:</p><select id="stateSelect" style="margin-bottom: 10px;"><option value="AL">Alabama</option>
	<option value="AK">Alaska</option>
	<option value="AZ">Arizona</option>
	<option value="AR">Arkansas</option>
	<option value="CA">California</option>
	<option value="CO">Colorado</option>
	<option value="CT">Connecticut</option>
	<option value="DE">Delaware</option>
	<option value="DC">District Of Columbia</option>
	<option value="FL">Florida</option>
	<option value="GA">Georgia</option>
	<option value="HI">Hawaii</option>
	<option value="ID">Idaho</option>
	<option value="IL">Illinois</option>
	<option value="IN">Indiana</option>
	<option value="IA">Iowa</option>
	<option value="KS">Kansas</option>
	<option value="KY">Kentucky</option>
	<option value="LA">Louisiana</option>
	<option value="ME">Maine</option>
	<option value="MD">Maryland</option>
	<option value="MA">Massachusetts</option>
	<option value="MI">Michigan</option>
	<option value="MN">Minnesota</option>
	<option value="MS">Mississippi</option>
	<option value="MO">Missouri</option>
	<option value="MT">Montana</option>
	<option value="NE">Nebraska</option>
	<option value="NV">Nevada</option>
	<option value="NH">New Hampshire</option>
	<option value="NJ">New Jersey</option>
	<option value="NM">New Mexico</option>
	<option value="NY">New York</option>
	<option value="NC">North Carolina</option>
	<option value="ND">North Dakota</option>
	<option value="OH">Ohio</option>
	<option value="OK">Oklahoma</option>
	<option value="OR">Oregon</option>
	<option value="PA">Pennsylvania</option>
	<option value="RI">Rhode Island</option>
	<option value="SC">South Carolina</option>
	<option value="SD">South Dakota</option>
	<option value="TN">Tennessee</option>
	<option value="TX">Texas</option>
	<option value="UT">Utah</option>
	<option value="VT">Vermont</option>
	<option value="VA">Virginia</option>
	<option value="WA">Washington</option>
	<option value="WV">West Virginia</option>
	<option value="WI">Wisconsin</option>
	<option value="WY">Wyoming</option></select></div><button class="sub" type="button" onclick="createUser()" style="margin-top:0px; margin-bottom: 15px;">Create New User</button> </div>
			<div class="col-lg-6 col-md-6 col-sm-12 section y3">
			<h4 class="underlined">Update the Database:</h4>
			<div class="col-12"><form action="javascript:updateDB(); return false;"><p class="lgfont" style="margin-bottom: 0px;">Enter Your userID:</p><input id="enterID" type="text"></form></div>
        	<div class="col-12"><form action="javascript:updateDB(); return false;"><p class="lgfont" style="margin-bottom: 0px;">Enter Title and Year of Movie to be Updated:</p><input id="updateTitle" type="text"></form></div>
        	<div>
        <p class="lgfont " style="margin-bottom:0px; margin-top:10px;">Select Field to Add:</p>
        <select id= "updateSelect" style="margin-bottom:15px;">
        	<option value="tags">Tags</option>
        	<option value="ratings">Ratings</option>
        </select>
        </div>
        <div>
        	<div class="col-12"><form action="javascript:updateDB();"><p class="lgfont" style="margin-bottom:0px;">Enter Value to Add:</p><input id="updateVal" type="text" style="margin-bottom:15px;"></form></div>
        	<button class="sub" type="button" onclick="updateDB()" style="margin-top:0px; margin-bottom: 15px;">Add to Database</button>
        </div>
        </div>
        </div>
        </div>
        
        	
        </div>
        <div id="dis"></div>
      </div>
      </div>
      <div class="row" id="restop">
      	<div class="col-12 head">
        <h3 class="outline"> Results</h3>
        </div>
        <div class= "col-12 content" >
        <div class="row" id="result" ><p class="none col-12" id="restitle">Use the fields above to search the Movie database.</p></div>
        </div>
      </div>
      
     
    

    </div>

    <script src='js/sql.js'></script>

      <script src="https://unpkg.com/github-api/dist/GitHub.bundle.min.js"></script>

    

    <script>
  
    var db;
    function r(){
    	var xhr = new XMLHttpRequest();
    //
xhr.open('GET', 'https://jrn011.github.io/CSCI305Project1/MovieInfo.db', true);
xhr.responseType = 'arraybuffer';
xhr.onload = function(b) {
var uInt8Array = new Uint8Array(this.response);
 db = new SQL.Database(uInt8Array);
 var o1= db.exec("PRAGMA foreign_keys= ON;")

}
xhr.send()
}
r();
	
	function createUser(){
		var j1= document.getElementById("updateUname")
		var j2= document.getElementById("stateSelect")
		var g= db.exec("select count(userID) from users")
		var nuid= g[0].values[0][0]
  		nuid=nuid+1
  		if(j1.value.length>0){
  		try{
		var g2= db.run("Insert into users(userID,userName,userState) values (?,?,?)",[nuid,j1.value,j2.value])
		var j3= document.createElement("p")
			j3.classList.add("none");
  	j3.classList.add("col-12")
		j3.innerHTML="Successfully created a new user with userID="+nuid+", userName='"+j1.value+"', userState="+j2.value
		var r1= document.getElementById("result")
		while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(j3);

	}catch(err){

		}
	}else{
		var j3= document.createElement("p")
			j3.classList.add("none");
  	j3.classList.add("col-12")
		j3.innerHTML="You must enter a user name!"
		var r1= document.getElementById("result")
		while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(j3);
	}
	var r4=document.getElementById("restop")
		r4.scrollIntoView();
		var binaryArray= db.export();
		var buff= new ArrayBuffer(binaryArray.buffer)
		console.log(binaryArray)
 var xhr2= new XMLHttpRequest();

 xhr2.onreadystatechange = function() {
    if (xhr2.readyState == XMLHttpRequest.DONE) {
        console.log(xhr2.responseText);
    }
}
xhr2.onload=  (r)=>{
	 console.log(r['target']['response']);

};
 var postData = {
        "message": "Update",
        "committer": {
    		"name": "Jack Napor",
    "email": "jrn011@bucknell.edu"
 	 },
        "content":  btoa(binaryArray)
    };

 xhr2.open("PUT",'https://api.github.com/repos/jrn011/CSCI305Project1/contents', true);
 xhr2.setRequestHeader("Authorization", "token 20e56817f72720cb67cd6f874b903d89ffaa042b")
 xhr2.setRequestHeader("Content-Type", 'application/json')
 
 xhr2.send(JSON.stringify(postData));


// basic auth
var gh = new GitHub({
  // username: 'jrn011',
  // password: 'july7116'
   
      token: '20e56817f72720cb67cd6f874b903d89ffaa042b'
  
});


var repo= gh.getRepo('jrn011','CSCI305Project1')
 repo.writeFile('master', '.', JSON.stringify(postData), 'u', function(err) {});

	}

	function searchState(){

		var state= document.getElementById("stateSearch")
		var r1= document.getElementById("result")


		while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }

		var k1= db.exec("select * from users where userState='"+state.options[state.selectedIndex].value+"'")
		var k2= db.exec("select count(userID) from users where userState='"+state.options[state.selectedIndex].value+"'")
		var lt2= document.createElement("h4")
		lt2.classList.add("col-12")
		lt2.classList.add("underlined")
		var ll= document.createElement("ul")
	
	
	
		lt2.innerHTML="Total Number of users from "+state.options[state.selectedIndex].value+": "+k2[0].values[0]
		r1.appendChild(lt2)
		k1[0].values.forEach((row) => { 
				var lk= document.createElement("li")
				lk.innerHTML="<p style='color: #FFA300; display:inline;'>UserID: "+row[0]+", UserName: "+row[1]+", UserState: "+row[2]+"</p>"
				//var lt= document.createTextNode("UserID: "+row[0]+", UserName: "+row[1]+", UserState: "+row[2])
				//lk.appendChild(lt)
				ll.appendChild(lk)
		})
		
		r1.appendChild(ll)
		var r3=document.getElementById("restop")
		r3.scrollIntoView();
	}

    function updateDB(){

    	var d = new Date();
var seconds = Math.round(Date.now() / 1000);

  var us= document.getElementById("updateSelect");
  var ut=document.getElementById("updateTitle")
  	var uv=document.getElementById("updateVal")
  	var un=document.getElementById("enterID")
  	var ss=document.getElementById("stateSelect")
  	var g= db.exec("select count(userID) from users")

  	var nuid= un.value
  
  	var r1= document.getElementById("result");
  
  	if(un.value===""||ut.value===""||uv.value===""){
  		var r1= document.getElementById("result");
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Invalid Entry, you must fill out all fields"
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);


  	}else if(us.options[us.selectedIndex].value==='tags'){
  	
  	
  	
  	var a1= db.exec("select count(tagID) from tags")
  	a1=a1[0].values[0][0]


  	var gmid= db.exec("select movieID from movies where title='"+ut.value+"'")
 	if(gmid.length>0){
  	gmid=gmid[0].values[0][0]
  
  	try{
  	var g3= db.run("Insert into tags(tagID,userID,movieID,tag,timestamp) values (?,?,?,?,?)",[a1,nuid,gmid,uv.value,seconds])


  	var g4= db.exec("select count(tagID) from tags")
  	
  	var g5= db.exec("select * from tags where tagID>1290 ")
 
  	var r1= document.getElementById("result");
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Successfully added a tag with values: (tagID: "+ a1+", userID: "+ nuid+", movieID: "+ gmid+", tag: "+ uv.value+", timestamp: "+seconds+")!"
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);} catch(err){
  		var r1= document.getElementById("result");
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Error: " +err.message+"! '"+nuid+"' is not a valid userID."
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);
  	}


  }else{ var r1= document.getElementById("result");
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Movie Title not in database or missing it's year. Example title: 'Toy Story (1995)'"
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);}
  }else{
  	if(us.options[us.selectedIndex].value==='ratings'){
  		
  	var a1= db.exec("select count(ratingID) from ratings")
  	a1=a1[0].values[0][0]


  	var gmid= db.exec("select movieID from movies where title='"+ut.value+"'")
  
  	if(gmid.length>0){
  	gmid=gmid[0].values[0][0]
  	
  	try{
  	var g3= db.run("Insert into ratings(ratingID,userID,movieID,rating,timestamp) values (?,?,?,?,?)",[a1,nuid,gmid,uv.value,seconds])
  var r1= document.getElementById("result");
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Successfully added a rating with values: (ratingID: "+ a1+", userID: "+ nuid+", movieID: "+ gmid+", rating: "+ uv.value+", timestamp: " +seconds+")"
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);}catch(err){
  		var r1= document.getElementById("result");
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Error: "+err.message;
  	if(err.message==="FOREIGN KEY constraint failed"){ p.innerHTML=p.innerHTML+"! '"+nuid+"' is not a valid userID."}
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);
  	}
  	


  }else{
  	var r1= document.getElementById("result");
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Movie Title not in database or missing it's year. Example title: 'Toy Story (1995)'"
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);
  
  	

  	}
  }
}

	var r3=document.getElementById("restop")
		r3.scrollIntoView();

  

    }




    function giveCount(){
    	var r1= document.getElementById("result");
    
    	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Loading..."
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);

    



  var item= document.getElementById("countSelect")
  var res= document.getElementById("result");
  
  	var y= db.exec("SELECT COUNT("+item.options[item.selectedIndex].value+"s."+item.options[item.selectedIndex].value+"ID) from "+item.options[item.selectedIndex].value+"s")
  	
  	var p3= document.createElement("p")
    p3.classList.add("none")
  	p3.classList.add("col-12")
  	p3.innerHTML="Number of "+ item.options[item.selectedIndex].value+ "s currently in the database: "+ y[0].values[0];
  	while(res.firstChild){
  	res.removeChild(res.firstChild);
  }
  	res.appendChild(p3)


var r3=document.getElementById("restop")
		r3.scrollIntoView();
}



    function searchGenre(){
    	var r1= document.getElementById("result");
   
      var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12")
  	p.innerHTML= "Loading..."
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);

   

  var x= document.getElementById("genre").value;
  var res= document.getElementById("result");
  while(res.firstChild){
  	res.removeChild(res.firstChild);
  }
  if(x.length>0){
  var contents= db.exec("SELECT * FROM movies where genres LIKE '%"+x+"%' limit 30");

 

  contents[0].values.forEach((row) => {
 
  var li =document.createElement("ul");
  var d= document.createElement("div");
  d.classList.add("col-3");
  d.classList.add("pdt-5");
  li.classList.add("resbox");

  var y= db.exec("SELECT AVG(rating) from ratings, movies where ratings.movieID=movies.movieID and movies.title='"+row[1].split("'").join("''")+"'")

 
  li.innerHTML="<li class='underlined' style='font-size:20px;'>"+row[1]+"</li><li class='subtext'>Genres: "+row[2].split("|").join(", ")+"</li><li class='subtext'>Average Rating: "+y[0].values[0].toString().substring(0,3)+"</li>"
  d.appendChild(li)
  res.appendChild(d)

  	
  });}else{ var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12");
  	p.innerHTML= "No results found!"
  	res.appendChild(p);}
  		var r3=document.getElementById("restop")
		r3.scrollIntoView();
 }

 	function loadTitle(_callback){
 		var r1= document.getElementById("result");
 		
      var p =document.createElement("p");
  	p.classList.add("none");
  	p.innerHTML= "Loading..."
  	p.classList.add("col-12");
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);

  	_callback();
  var r3=document.getElementById("restop")
		r3.scrollIntoView();
 	}

    function searchTitle(){
    	loadTitle(function(){
    		
    	});
      var r1= document.getElementById("result");
   
      var p =document.createElement("p");
  	p.classList.add("none");
  	p.innerHTML= "Loading..."
  	p.classList.add("col-12");
  	while(r1.firstChild){
  	r1.removeChild(r1.firstChild);
  }
  	r1.appendChild(p);

    

  var t=document.getElementById("Title").value;

  var contents=null;
  if(t.includes("*")){
  	var x= t.split("*",1)
  	var b= x[0].split("'").join("''")
  	  var stats= document.getElementById("showstats");
  	  if(stats.options[stats.selectedIndex].value==="no"){
  	  	contents= db.exec("SELECT * FROM movies where title LIKE '%"+b+"%' limit 100");
  	  }else{
  	    contents= db.exec("SELECT * FROM movies where title LIKE '%"+b+"%' limit 30");
  	  }
  	
  }else{
  	
  	var stats= document.getElementById("showstats");
  	var b= t.split("'").join("''")
  	 if(stats.options[stats.selectedIndex].value==="no"){   contents = db.exec("SELECT * FROM movies WHERE title LIKE '"+b+" (%' limit 100");}else{
  	 	contents = db.exec("SELECT * FROM movies WHERE title LIKE '"+b+" (%' limit 30");
  	 }
}
  var res= document.getElementById("result");
  while(res.firstChild){
  	res.removeChild(res.firstChild);
  }
 
  if(contents.length>0){
  	var count=0;
  contents[0].values.forEach((row) => { 

  var li =document.createElement("li");
  var stats= document.getElementById("showstats");
  count=count+1;
  var genres= document.getElementById("showgenres");



   
  if(stats.options[stats.selectedIndex].value==="no"){
  	  var nd= document.createElement("div");
  	  var ul=document.createElement("ul");
	nd.classList.add("col-lg-3")
	nd.classList.add("col-md-6")
	nd.classList.add("col-sm-12")
	nd.classList.add("pdt-5")
	ul.classList.add("resbox")
	ul.classList.add("yello")
  	  ul.innerHTML="<li class='underlined' >"+row[1]+"</li>";
  	 if(genres.options[genres.selectedIndex].value==="yes"){
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	var ligt= document.createTextNode("Genres: "+row[2].split("|").join(", "))
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
    var relyear= document.getElementById("showyear")
    if(relyear.options[relyear.selectedIndex].value==="yes"){
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	var ligt= document.createTextNode("Release Year: "+row[3])
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
    var tgs= document.getElementById("showtags")
    if(tgs.options[tgs.selectedIndex].value==="yes"){
    	 
    var v1= db.exec("SELECT tag from tags where tags.movieID="+row[0].toString())
 
   
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	if(v1.length>0){
  	var ligt= document.createTextNode("Tags: "+v1[0].values.join(", "))}
  	else{var ligt= document.createTextNode("Tags: None ")}
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
    var allrt= document.getElementById("showrating")
    if(allrt.options[allrt.selectedIndex].value==="yes"){
    	 
    var v1= db.exec("SELECT rating from ratings where ratings.movieID="+row[0].toString())
 	
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	if(v1.length>0){

  	var ligt= document.createTextNode("All ratings: "+v1[0].values.join(", "))}
  	else{var ligt= document.createTextNode("All ratings: None ")}
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
  	  nd.appendChild(ul);
  res.appendChild(nd);
}else{ 
	y= db.exec("SELECT COUNT(ratingID) from ratings, movies where ratings.movieID=movies.movieID and movies.title='"+row[1].replace(/'/g,"''") +"'")
	var y2= db.exec("SELECT rating from ratings, movies where ratings.movieID=movies.movieID and movies.title='"+row[1].replace(/'/g,"''") +"' order by rating desc limit 1")
	
	var y3= db.exec("SELECT rating from ratings, movies where ratings.movieID=movies.movieID and movies.title='"+row[1].replace(/'/g,"''") +"' order by rating asc limit 1")
	var y4= db.exec("SELECT AVG(rating) from ratings, movies where ratings.movieID=movies.movieID and movies.title='"+row[1].replace(/'/g,"''") +"'")
	
	var nd= document.createElement("div");
	var ul=document.createElement("ul");
	nd.classList.add("col-lg-3")
	nd.classList.add("col-md-6")
	nd.classList.add("col-sm-12")
	nd.classList.add("pdt-5")
	ul.classList.add("resbox")
	ul.classList.add("yello")

	ul.innerHTML="<li class='underlined orng ' >"+row[1]+"</li>"+"<li class='subtext'>"+"Average Rating: "+ y4[0].values[0].toString().substring(0,3)+"</li>"+ "<li class='subtext'>"+"Number of ratings: "+ y[0].values[0]+"</li><li class='subtext'>Highest Rating: "+y2[0].values[0]+"</li><li class='subtext'>Lowest Rating: "+y3[0].values[0]+"</li>"
	
	if(genres.options[genres.selectedIndex].value==="yes"){
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	var ligt= document.createTextNode("Genres: "+row[2].split("|").join(", "))
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
    var relyear= document.getElementById("showyear")
    if(relyear.options[relyear.selectedIndex].value==="yes"){
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	var ligt= document.createTextNode("Release Year: "+row[3])
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
    var tgs= document.getElementById("showtags")
    if(tgs.options[tgs.selectedIndex].value==="yes"){
    	 
    var v1= db.exec("SELECT tag from tags where tags.movieID="+row[0].toString())
 
   
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	if(v1.length>0){
  	var ligt= document.createTextNode("Tags: "+v1[0].values.join(", "))}
  	else{var ligt= document.createTextNode("Tags: None ")}
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
    var allrt= document.getElementById("showrating")
    if(allrt.options[allrt.selectedIndex].value==="yes"){
    	 
    var v1= db.exec("SELECT rating from ratings where ratings.movieID="+row[0].toString())
 
  	var lig= document.createElement("li")
  	lig.classList.add("subtext")
  	if(v1.length>0){

  	var ligt= document.createTextNode("All ratings: "+v1[0].values.join(", "))}
  	else{var ligt= document.createTextNode("All ratings: None ")}
  	lig.appendChild(ligt)
  	ul.appendChild(lig)
    }
	

	//li.textContent=row[1]+ "Number of ratings: "+y[0].values[0];
	nd.appendChild(ul);
  res.appendChild(nd);}
 

   });}else{
  	var p =document.createElement("p");
  	p.classList.add("none");
  	p.classList.add("col-12");
  	p.innerHTML= "No results found!"
  	res.appendChild(p);

  }
var r3=document.getElementById("restop")
		r3.scrollIntoView();


}


</script>
  </body>
</html>



